FROM quay.io/thoth-station/s2i-minimal-notebook:latest
LABEL "io.openshift.s2i.build.commit.date"="Thu Feb 10 12:30:33 2022 -0800" \
      "io.openshift.s2i.build.commit.id"="46c622a4ce5a769d022802e80358ed3dd9b17f32" \
      "io.openshift.s2i.build.commit.ref"="testing" \
      "io.openshift.s2i.build.commit.message"="test s2i" \
      "io.openshift.s2i.build.source-location"="/home/grpereir/Documents/thoth-station/s2i-tensorflow-notebook/." \
      "io.openshift.s2i.build.image"="quay.io/thoth-station/s2i-minimal-notebook:latest" \
      "io.openshift.s2i.build.commit.author"="Gregory-Pereira <grpereir@redhat.com>"
ENV XDG_CACHE_HOME="/opt/app-root/src/.cache" \
    ENABLE_PIPENV="1" \
    THOTH_ADVISE="0" \
    THOTH_ERROR_FALLBACK="1" \
    THOTH_DRY_RUN="1" \
    THOTH_PROVENANCE_CHECK="0" \
    THAMOS_RUNTIME_ENVIRONMENT="ubi8-py36"
USER root
# Copying in override assemble/run scripts
COPY upload/scripts /tmp/scripts
# Copying in source code
COPY upload/src /tmp/src
# Change file ownership to the assemble user. Builder image must support chown command.
RUN chown -R 1001:0 /tmp/scripts /tmp/src
USER 1001
RUN /tmp/scripts/assemble
CMD /tmp/scripts/run
